<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ACLS 2025 ç´€éŒ„åŠ©æ‰‹ (å«åŒ¯å‡º)</title>
    <style>
        :root {
            --shock-red: #d9534f;
            --shock-gold: #ffc107;
            --pea-blue: #31708f;
            --bg-gray: #f8f9fa;
            --text-dark: #212529;
            --drug-green: #28a745;
        }

        body {
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-gray);
            color: var(--text-dark);
            margin: 0; padding: env(safe-area-inset-top) 10px 20px 10px;
            display: flex; flex-direction: column; align-items: center;
        }

        .container { max-width: 500px; width: 100%; }
        h1 { font-size: 1.4rem; text-align: center; color: var(--pea-blue); margin: 15px 0; }

        /* è¨ˆæ™‚å™¨å€åŸŸ */
        .timer-card {
            background: white; border: 3px solid var(--shock-red); border-radius: 15px;
            padding: 20px; text-align: center; margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .timer-display { font-size: 4rem; font-weight: 800; font-family: 'Courier New', monospace; color: var(--shock-red); }
        .timer-label { font-size: 0.9rem; font-weight: bold; color: #666; }

        /* æŒ‰éˆ•çŸ©é™£ */
        .grid-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn {
            border: none; border-radius: 10px; padding: 18px 10px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.1s;
            display: flex; align-items: center; justify-content: center;
        }
        .btn:active { transform: scale(0.95); opacity: 0.8; }

        .btn-start { background: var(--shock-red); color: white; width: 100%; padding: 30px; font-size: 1.5rem; }
        .btn-shock { background: var(--shock-gold); color: black; grid-column: span 2; font-size: 1.4rem; border: 2px solid #e0a800; }
        .btn-drug { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .btn-action { background: #e9ecef; color: #495057; }
        .btn-rosc { background: var(--drug-green); color: white; grid-column: span 2; margin-top: 10px; }
        .btn-export { background: #6c757d; color: white; width: 100%; margin-top: 10px; font-size: 0.9rem; padding: 10px; }

        /* å½ˆçª— */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center;
        }
        .modal-content { background: white; width: 85%; max-width: 350px; padding: 25px; border-radius: 20px; text-align: center; }

        /* ç´€éŒ„å€ */
        .log-header { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        .log-area {
            background: white; border-radius: 10px; 
            height: 200px; overflow-y: auto; border: 1px solid #ddd; margin-top: 5px;
        }
        .log-entry { font-size: 0.85rem; padding: 8px 12px; border-bottom: 1px solid #eee; display: flex; }
        .log-time { font-weight: bold; color: var(--pea-blue); margin-right: 10px; }
        .log-msg-shock { color: var(--shock-red); font-weight: bold; }

        #main-ui { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ACLS 2025 æ™ºæ…§ç´€éŒ„åŠ©æ‰‹</h1>

        <div id="start-screen">
            <button class="btn btn-start" onclick="startEmergency()">ğŸ”´ PULSELESS<br><small>é–‹å§‹ç´€éŒ„</small></button>
        </div>

        <div id="main-ui">
            <div class="timer-card">
                <div class="timer-label">CPR å¾ªç’°å€’æ•¸ (2åˆ†é˜)</div>
                <div id="timer" class="timer-display">02:00</div>
            </div>

            <div class="grid-buttons">
                <button class="btn btn-shock" onclick="triggerShockFlow()">âš¡ SHOCK é›»æ“Š</button>
                <button class="btn btn-drug" onclick="logMed('Epinephrine 1mg')">ğŸ’‰ Epi 1mg</button>
                <button class="btn btn-drug" onclick="logMed('Amiodarone 300mg')">ğŸ’Š Amio 300</button>
                <button class="btn btn-drug" onclick="logMed('Amiodarone 150mg')">ğŸ’Š Amio 150</button>
                <button class="btn btn-drug" onclick="logMed('Lidocaine 1-1.5mg/kg')">ğŸ’Š Lido</button>
                <button class="btn btn-action" onclick="logAction('ET Tube æ’ç®¡å®Œæˆ')">ç®¡ ET Tube</button>
                <button class="btn btn-action" onclick="manualReset()">ğŸ”„ æ‰‹å‹•é‡ç½®</button>
                <button class="btn btn-rosc" onclick="handleROSC()">ğŸŒŸ ROSC æˆåŠŸ</button>
            </div>

            <div class="log-header">
                <span style="font-weight:bold;">æ€¥æ•‘æ­·ç¨‹ç´€éŒ„:</span>
                <button class="btn-export" style="width:auto; margin:0;" onclick="exportLog()">ğŸ“‹ è¤‡è£½æ‰€æœ‰ç´€éŒ„</button>
            </div>
            <div class="log-area" id="log">
                <div class="log-entry">å°šæœªé–‹å§‹...</div>
            </div>
        </div>
    </div>

    <div id="rhythm-modal" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--shock-red)">âš ï¸ 2åˆ†é˜æ™‚é–“åˆ°</h2>
            <p>è«‹ç¢ºèªç•¶å‰å¿ƒå¾‹ï¼š</p>
            <div class="grid-buttons">
                <button class="btn btn-shock" style="grid-column: span 1;" onclick="triggerShockFlow()">VF</button>
                <button class="btn btn-shock" style="grid-column: span 1;" onclick="triggerShockFlow()">pVT</button>
                <button class="btn btn-action" onclick="logRhythmAndStart('PEA')">PEA</button>
                <button class="btn btn-action" onclick="logRhythmAndStart('Asystole')">Asystole</button>
            </div>
        </div>
    </div>

    <div id="shock-confirm-modal" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--shock-gold)">âš¡ é›»æ“Šç¯€å¾‹ç¢ºèª</h2>
            <div class="grid-buttons">
                <button class="btn btn-start" style="background:var(--shock-gold); color:black;" onclick="executeShock('VF')">VF</button>
                <button class="btn btn-start" style="background:var(--shock-gold); color:black;" onclick="executeShock('pVT')">pVT</button>
            </div>
            <br>
            <button class="btn btn-action" style="width:100%" onclick="closeModals()">å–æ¶ˆ</button>
        </div>
    </div>

    <script>
        let timerSeconds = 120;
        let timerInterval;
        let shockCount = 0;
        let eventLogs = []; // ç”¨æ–¼å„²å­˜ç´€éŒ„è³‡æ–™

        function getTime() {
            return new Date().toLocaleTimeString('zh-TW', { hour12: false });
        }

        function addLog(msg, isShock = false) {
            const logBox = document.getElementById('log');
            if (logBox.innerHTML.includes("å°šæœªé–‹å§‹")) logBox.innerHTML = "";
            
            const timeStr = getTime();
            eventLogs.push({ time: timeStr, message: msg }); // å„²å­˜åˆ°é™£åˆ—

            const entry = document.createElement('div');
            entry.className = isShock ? 'log-entry log-msg-shock' : 'log-entry';
            entry.innerHTML = `<span class="log-time">${timeStr}</span><span>${msg}</span>`;
            logBox.prepend(entry);
        }

        function startEmergency() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';
            addLog("ğŸ›‘ ACLS æ€¥æ•‘å•Ÿå‹• (Pulseless)");
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerSeconds = 120;
            updateDisplay();
            timerInterval = setInterval(() => {
                timerSeconds--;
                updateDisplay();
                if (timerSeconds <= 0) {
                    clearInterval(timerInterval);
                    document.getElementById('rhythm-modal').style.display = 'flex';
                }
            }, 1000);
        }

        function updateDisplay() {
            const m = Math.floor(timerSeconds / 60).toString().padStart(2, '0');
            const s = (timerSeconds % 60).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `${m}:${s}`;
        }

        function triggerShockFlow() {
            closeModals();
            document.getElementById('shock-confirm-modal').style.display = 'flex';
        }

        function executeShock(rhythm) {
            shockCount++;
            addLog(`âš¡ ç¬¬ ${shockCount} æ¬¡é›»æ“Š (Rhythm: ${rhythm})`, true);
            closeModals();
            startTimer();
        }

        function logRhythmAndStart(rhythm) {
            addLog(`ğŸ” ç¯€å¾‹åˆ†æ: ${rhythm}`);
            closeModals();
            startTimer();
        }

        function logMed(name) { addLog(`ğŸ’‰ çµ¦è—¥: ${name}`); }
        function logAction(act) { addLog(`ğŸ› ï¸ å‹•ä½œ: ${act}`); }

        function handleROSC() {
            clearInterval(timerInterval);
            addLog("ğŸŒŸ ROSCï¼æ¢å¾©è‡ªç™¼å¾ªç’°", true);
            alert("å·²è¨˜éŒ„ ROSCï¼Œè¨ˆæ™‚åœæ­¢ã€‚");
        }

        function exportLog() {
            if (eventLogs.length === 0) return alert("å°šç„¡ç´€éŒ„");
            // å°‡é™£åˆ—è½‰åŒ–ç‚ºæ–‡å­—æ ¼å¼ï¼Œå¾æœ€æ—©åˆ°æœ€æ™šæ’åº
            const logText = eventLogs.map(item => `[${item.time}] ${item.message}`).reverse().join('\n');
            
            navigator.clipboard.writeText(logText).then(() => {
                alert("ç´€éŒ„å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼\n\nç¯„ä¾‹ï¼š\n" + logText.substring(0, 100) + "...");
            }).catch(err => {
                console.error('ç„¡æ³•è¤‡è£½', err);
            });
        }

        function manualReset() {
            if(confirm("ç¢ºå®šé‡ç½® 2 åˆ†é˜å¾ªç’°ï¼Ÿ")) startTimer();
        }

        function closeModals() {
            document.getElementById('rhythm-modal').style.display = 'none';
            document.getElementById('shock-confirm-modal').style.display = 'none';
        }
    </script>
</body>
</html>
